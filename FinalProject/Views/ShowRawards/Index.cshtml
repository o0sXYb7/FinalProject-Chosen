<div id="app">
    <div class="table-header mb-2">
        <h3 class="fw-bolder">
            獎池資訊
        </h3>
    </div>

    <div class="d-flex">
        <a @@click="modelType='',clrarModal()" class="btn btn-success text-white mb-2" data-bs-toggle="modal" data-bs-target="#showDetail">新增獎池</a>
    </div>

    <div class="d-flex mb-2">

        <div class="d-flex align-items-end me-auto">
            <span style="min-width:35px">每頁:</span>
            <select class="form-select form-select-sm" @@change="selectPerPage" v-model="savedPageLength">
                <option v-for="(item,index) in perpage" :key="index" :value="item">{{item}}</option>
            </select>
            <span>筆</span>
        </div>

        <div class="d-flex">
            <select class="form-select form-select-sm" v-model.trim="nowFilter">
                <option v-for="(item,index) in filterList" :key="index" :value="item">{{item}}</option>
            </select>
            <div class="input-group input-group-merge" style="min-width:250px">
                <span class="input-group-text" id="basic-addon-search31"><i class="bx bx-search"></i></span>
                <input type="text"
                       class="form-control"
                       placeholder="Search..."
                       aria-label="Search..."
                       aria-describedby="basic-addon-search31"
                       v-model="searchInput"
                       @@keyup="filterDataPage" />
            </div>
        </div>
    </div>

    <div class="table-responsive">
        <table id="mainTable"
               class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th class="center">
                        <label>
                            <input type="checkbox" />
                            <span class="lbl"></span>
                        </label>
                    </th>
                    <th>系列</th>
                    <th>名稱</th>
                    <th>廠商</th>
                    <th>功能</th>
                    <th>細節項目</th>
                </tr>
            </thead>

            <tbody>
                <tr v-for="item in filterPageData">
                    <td class="center">
                        <label>
                            <input type="checkbox" />
                            <span class="lbl"></span>
                        </label>
                    </td>
                    <td>{{item.series}}</td>
                    <td>{{item.name}}</td>
                    <td>{{changeFactoryName(item.factoryId)}}</td>
                    <td>
                        <a @@click="modelType='edit',openModelToUpdate(item.showRawardId)" data-bs-toggle="modal" data-bs-target="#showDetail"><i class="tf-icons bx bx-edit-alt"></i></a> |
                        <a @@click="modelType='detail',openModelToUpdate(item.showRawardId)" data-bs-toggle="modal" data-bs-target="#showDetail"><i class="tf-icons bx bxs-book text-info"></i></a> |
                        <a @@click="deleteRawardLibs(item.showRawardId)"><i class="tf-icons bx bx-trash text-danger"></i></a>
                    </td>
                    <td>
                        <a @@click="goToDetail(item.showRawardId)"><i class="tf-icons bx bx-detail"></i></a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="col-md justify-content-center" :class="{'d-none':loading,'d-flex':!loading}">
        <div class="demo-inline-spacing">
            <div class="spinner-border spinner-border-lg text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-end flex-wrap">

            <li :class="{'disabled':nowPage==1,'page-item':true,'prev':true}" @@click="nowPage>1 ? nowPage-- : nowPage =1">
                <a class="page-link">
                    <i class="tf-icon bx bx-chevrons-left"></i>
                </a>
            </li>

            <li :class="{'active':item==nowPage,'page-item':true}" v-for="item in paginationNum" @@click="nowPage = item">
                <a class="page-link">{{item}}</a>
            </li>

            <li :class="{'disabled':nowPage==paginationNum,'page-item':true,'next':true}" @@click="nowPage<paginationNum ? nowPage++ : nowPage =paginationNum">
                <a class="page-link">
                    <i class="tf-icon bx bx-chevrons-right"></i>
                </a>
            </li>

        </ul>
    </nav>

    <!-- Modal -->
    <div class="modal fade" id="showDetail" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" id="modalContext">
                <form asp-controller="ShowRawards" asp-action="UpdateRawardLibs">

                    <div class="modal-header">
                        <template v-if="modelType == 'edit'">
                            <h4 class="modal-title fw-bolder" id="showDetailLabel">資料修改</h4>
                        </template>
                        <template v-if="modelType==''">
                            <h4 class="modal-title fw-bolder" id="showDetailLabel">資料新增</h4>
                        </template>
                        <template v-if="modelType=='detial'">
                            <h4 class="modal-title fw-bolder" id="showDetailLabel">資料瀏覽</h4>
                        </template>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <table class="table-specil">
                            <tbody>
                                <template v-if="modelType == 'detail'">
                                    <tr>
                                        <th>系列</th>
                                        <td>
                                            <input class="form-control" readonly v-model="ShowRawardSeries" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>名稱</th>
                                        <td>
                                            <input class="form-control" readonly v-model="ShowRawardName" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>增加機率</th>
                                        <td>
                                            <input class="form-control" readonly v-model="ShowRwardAddProbability" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>目前機率</th>
                                        <td>
                                            <input class="form-control" readonly v-model="ShowRwardNowProbability" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>允許存放天數</th>
                                        <td>
                                            <input class="form-control" readonly v-model="ShowRwardAllowStoreDay" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>運費</th>
                                        <td>
                                            <input class="form-control" readonly v-model="ShowRwardFare" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>一抽費用</th>
                                        <td>
                                            <input class="form-control" readonly v-model="ShowRwardOneDrawMoney" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>建立時間</th>
                                        <td>
                                            <input class="form-control" readonly type="date" v-model="timeFilter" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>開啟獎池</th>
                                        <td>
                                            <input class="form-check-input" disabled type="checkbox" v-model="ShowRwardIsOpen" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>簡介</th>
                                        <td>
                                            <textarea class="form-control" readonly v-model="ShowRwardIntroduction"></textarea>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>圖片</th>
                                        <td>
                                            <input class="form-control" readonly v-model="ShowRwardImage" />
                                            <div class="imgbox">
                                                <img id="previewImage" src="#" alt="預覽圖片" width="200">
                                            </div>
                                        </td>
                                    </tr>
                                </template>

                                <template v-if="modelType == 'edit'||modelType == ''">
                                    <tr>
                                        <th>系列</th>
                                        <td>
                                            <input class="form-control" v-model="ShowRawardSeries" />
                                            <span class="text-danger">{{seriesErrorMessage}}</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>名稱</th>
                                        <td>
                                            <input class="form-control" v-model="ShowRawardName" />
                                            <span class="text-danger">{{nameErrorMessage}}</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>選擇/變更廠商</th>
                                        <td>
                                            <select class="form-select h-100" @@change="selectFactory" v-model="ShowRawardFirm">
                                                <option disabled value="">---請選擇---</option>
                                                <option v-for="item in selectFactoriesName" :value="item">{{item}}</option>
                                            </select>
                                            <input class="form-control" readonly v-model="ShowRawardFirm" />
                                            <span class="text-danger">{{firmErrorMessage}}</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>增加機率</th>
                                        <td>
                                            <input class="form-control" v-model="ShowRwardAddProbability" />
                                            <span class="text-danger">{{addProErrorMessage}}</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>允許存放天數</th>
                                        <td>
                                            <input class="form-control" v-model="ShowRwardAllowStoreDay" />
                                            <span class="text-danger">{{allowErrorMessage}}</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>運費</th>
                                        <td>
                                            <input class="form-control" v-model="ShowRwardFare" />
                                            <span class="text-danger">{{fareErrorMessage}}</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>一抽費用</th>
                                        <td>
                                            <input class="form-control" v-model="ShowRwardOneDrawMoney" />
                                            <span class="text-danger">{{moneyErrorMessage}}</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>開啟獎池</th>
                                        <td>
                                            <input class="form-check-input" type="checkbox" v-model="ShowRwardIsOpen" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>簡介</th>
                                        <td>
                                            <textarea class="form-control" v-model="ShowRwardIntroduction"></textarea>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>圖片</th>
                                        <td>
                                            <div class="imgbox">
                                                <div class="input-group mb-1">
                                                    <label class="input-group-text">選擇系列</label>
                                                    <select class="form-select h-100" @@change="selectSeries" v-model="nowSelectSeries">
                                                        <option disabled value="">---請選擇---</option>
                                                        <option v-for="item in selectSeriesList" :value="item">{{item}}</option>
                                                    </select>
                                                </div>
                                                <div class="input-group">
                                                    <label class="input-group-text">系列名稱</label>
                                                    <select class="form-select h-100" @@change="selectNames" v-model="nowSelectName">
                                                        <option disabled value="">---請選擇---</option>
                                                        <option v-for="item in selectNamesList" :value="item">{{item}}</option>
                                                    </select>
                                                </div>
                                                <div class="input-group">
                                                    <label class="input-group-text">圖片名稱</label>
                                                    <select class="form-select h-100" @@change="selectImage" v-model="ShowRwardImage">
                                                        <option disabled value="">---請選擇---</option>
                                                        <option v-for="item in selectImageList" :value="item">{{item}}</option>
                                                    </select>
                                                </div>
                                                <img id="previewImage" src="#" alt="預覽圖片" width="200">
                                            </div>
                                            <span class="text-danger">{{imageErrorMessage}}</span>
                                        </td>
                                    </tr>
                                </template>                              

                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <template v-if="modelType=='edit'">
                            <button @@click="updataRawardLib(NowSelectId)" type="button" class="btn btn-primary text-white">修改</button>
                        </template>
                        <template v-if="modelType==''">
                            <button @@click="createRawardLib()" type="button" class="btn btn-primary text-white">存檔</button>
                        </template>
                        <button @@click="clrarModal()" type="button" class="btn btn-secondary text-white" data-bs-dismiss="modal">關閉</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>
@section Scripts
    {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>       
        let vueApp = {

            data() {
                return {
                    //初始資料
                    dbData: [],
                    dbDataLen: 0,
                    //過濾項目
                    filterList: ["全部", "系列", "名稱","廠商"],
                    nowFilter: "全部",
                    searchInput: "",
                    //MODAL目前顯示資料
                    ShowRawardSeries: '',
                    ShowRawardName: '',
                    ShowRawardFirm:'',
                    ShowRawardFirmId:0,
                    ShowRwardAddProbability:0,
                    ShowRwardNowProbability:0,
                    ShowRwardAllowStoreDay:0,
                    ShowRwardFare:0,
                    ShowRwardOneDrawMoney:0,
                    ShowRwardIsOpen:false,
                    ShowRwardCreateTime:null,
                    ShowRwardIntroduction:'',
                    ShowRwardImage:'',
                    ShowHasSelectNumber: '',
                    NowSelectId: null,
                    //錯誤訊息
                    ErrorTitle: [],
                    ErrorMessage: [],
                    //pagination
                    nowPage: 1,
                    paginationNum: null,
                    //per page
                    savedPageLength: null,
                    defaultPageLength: 10,
                    perpage: [10, 25, 50, 100],
                    //loading control
                    loading: true,
                    //目前Model是哪一種
                    modelType:'',
                    //圖片的 select
                    selectSeriesList: [],
                    selectNamesList: [],
                    selectImageList: [],
                    nowSelectSeries: '',
                    nowSelectName: '',
                    //圖庫地址
                    imageAddress: `/img/webDataPicture/`,
                    //廠商資料
                    selectFactoryList:[],
                    selectFactoriesName:[],
                }
            },
            methods: {
                getCookie(name) {
                    // 取得 Cookie
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        let cookies = document.cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            let cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                },
                setCookie(name, value, days) {
                    // 設定 Cookie
                    let expires = '';
                    if (days) {
                        let date = new Date();
                        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                        expires = '; expires=' + date.toUTCString(); //存入cookie中的過期時間
                    }
                    document.cookie = name + '=' + encodeURIComponent(value) + expires + '; path=/';
                },
                getRawardLibs() {
                    let _this = this;
                    _this.loading = false;
                    axios.get(`@Url.Action("getShowRaward","ShowRawards")`)
                        .then((res) => {
                            //console.log(res.data);
                            _this.dbData = res.data;
                            _this.dbDataLen = res.data.length;

                            //初始pagation
                            _this.filterDataPage();
                            _this.loading = true;

                            //取得 Image
                            axios.get(`@Url.Action("getImageStores","ImageStores")`)
                                .then((res) => {
                                    //console.log(res.data)
                                    _this.imageData = res.data;
                                    for (let item of _this.imageData) {
                                        if (_this.selectSeriesList.indexOf(item.series) == -1) {
                                            _this.selectSeriesList.push(item.series)
                                        }
                                    }
                                })

                            //取得 Factory
                            axios.get(`@Url.Action("getFactory","Factories")`)
                                .then((res) => {
                                    _this.selectFactoryList = [];
                                    _this.selectFactoriesName = [];
                                    //console.log(res.data)
                                    _this.selectFactoryList = res.data;
                                    _this.selectFactoryList.forEach(function(item){
                                        /*console.log(item.name)*/
                                        _this.selectFactoriesName.push(item.name)
                                    })
                                })
                        });
                },
                openModelToUpdate(rawardId) {
                    let _this = this;
                    _this.clrarModal();
                    axios.get(`@Url.Action("OPenModalToUpdate","ShowRawards")/${rawardId}`)
                        .then((res) => {
                            _this.NowSelectId = res.data.showRawardId;
                            _this.ShowRawardSeries = res.data.series;
                            _this.ShowRawardName = res.data.name;
                            _this.ShowRawardFirmId = res.data.factoryId;
                            _this.ShowRwardAddProbability = res.data.addProbability;
                            _this.ShowRwardNowProbability = res.data.nowProbability;
                            _this.ShowRwardAllowStoreDay = res.data.allowStoreDay;
                            _this.ShowRwardFare = res.data.fare;
                            _this.ShowRwardOneDrawMoney = res.data.oneDrawMoney;
                            _this.ShowRwardIsOpen = res.data.isOpen;
                            _this.ShowRwardCreateTime = res.data.createTime;
                            _this.ShowRwardIntroduction = res.data.introduction;
                            _this.ShowRwardImage = res.data.image;
                            _this.ShowHasSelectNumber = res.data.hasSelectNumber

                            $("#previewImage").attr("src", `${_this.imageAddress}${res.data.image}`);
                        })
                        .then((res)=>{
                            _this.selectFactoryList.forEach(function(item){
                                if (item.factoryId == _this.ShowRawardFirmId) {
                                    _this.ShowRawardFirm = item.name
                                }
                            })                           
                        })
                        ;
                },
                updataRawardLib(rawardId) {
                    let _this = this;

                    let request = {
                        ShowRawardId: _this.NowSelectId,
                        Name: _this.ShowRawardName,
                        Series: _this.ShowRawardSeries,
                        FactoryId: _this.ShowRawardFirmId,
                        AddProbability: _this.ShowRwardAddProbability != "" ? _this.ShowRwardAddProbability : 0,
                        NowProbability: _this.ShowRwardNowProbability != "" ? _this.ShowRwardNowProbability : 0,
                        AllowStoreDay: _this.ShowRwardAllowStoreDay != "" ? _this.ShowRwardAllowStoreDay : 0,
                        Fare: _this.ShowRwardFare != "" ? _this.ShowRwardFare : 0,
                        OneDrawMoney: _this.ShowRwardOneDrawMoney != "" ? _this.ShowRwardOneDrawMoney : 0,
                        IsOpen:_this.ShowRwardIsOpen,
                        CreateTime: _this.ShowRwardCreateTime,
                        Introduction: _this.ShowRwardIntroduction,
                        Image: _this.ShowRwardImage,
                        HasSelectNumber: _this.ShowHasSelectNumber,
                    };

                    axios.defaults.headers.common['RequestVerificationToken'] = $('input[name="__RequestVerificationToken"]').val();
                    axios.put(`@Url.Action("UpdateRawardLibs","ShowRawards")/${rawardId}`, request)
                        .then((res) => {
                            $('#showDetail').modal('hide');
                            _this.getRawardLibs();
                        })
                        .catch((err) => {
                            //console.log(err.response.data);
                            _this.ErrorTitle = Object.keys(err.response.data);
                            let ArratList = [];
                            for (let item in err.response.data) {
                                ArratList.push(err.response.data[item]);
                            }
                            _this.ErrorMessage = ArratList;

                        });
                },
                deleteRawardLibs(rawardId) {
                    let _this = this;
                    Swal.fire({
                        title: '您確定要刪除此筆資料?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d15b47',
                        cancelButtonColor: '#abbac3',
                        confirmButtonText: '確認'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            axios.delete(`@Url.Action("Delete","ShowRawards")/${rawardId}`)
                                .then((res) => {
                                    //console.log(res)
                                    Swal.fire(
                                        `${res.data == "success" ? "資料刪除成功!" : "資料刪除失敗!"}`,
                                        '',
                                        `${res.data == "success" ? "success" : "error"}`
                                    ).then((res) => {
                                        if (res.isConfirmed) {
                                            $('#showDetail').modal('hide');
                                            _this.getRawardLibs();
                                        }
                                    })
                                });
                        }
                    })
                },
                goToDetail(rawardId) {
                    let _this = this;
                    axios.get(`@Url.Action("Index","ShowRawardItems")/${rawardId}`)
                        .then((res) => {
                            window.location.href = res.request.responseURL;
                        });
                },
                clrarModal() {
                    let _this = this;
                    _this.ShowRawardSeries = '';
                    _this.ShowRawardName = '';
                    _this.ShowRawardFirm =  '';
                    _this.ShowRawardFirmId = 0;
                    _this.ShowRwardAddProbability = 0;
                    _this.ShowRwardNowProbability = 0;
                    _this.ShowRwardAllowStoreDay = 0;
                    _this.ShowRwardFare = 0;
                    _this.ShowRwardOneDrawMoney = 0;
                    _this.ShowRwardIsOpen = false;
                    _this.ShowRwardCreateTime = null;
                    _this.ShowRwardIntroduction = '';
                    _this.ShowRwardImage = '';
                    _this.ShowHasSelectNumber = '';
                    _this.NowSelectId = null;
                    _this.ErrorTitle = [];
                    _this.ErrorMessage = [];
                    _this.selectNamesList = [];
                    _this.selectImageList = [];
                    _this.nowSelectSeries = '';
                    _this.nowSelectName = '';                  
                    $("#previewImage").attr("src", '');
                },
                createRawardLib() {
                    let _this = this;

                    let request = {
                        Name: _this.ShowRawardName,
                        Series: _this.ShowRawardSeries,
                        FactoryId: _this.ShowRawardFirmId,
                        AddProbability: _this.ShowRwardAddProbability != "" ? _this.ShowRwardAddProbability : 0,
                        NowProbability: _this.ShowRwardNowProbability != "" ? _this.ShowRwardNowProbability : 0,
                        AllowStoreDay: _this.ShowRwardAllowStoreDay != "" ? _this.ShowRwardAllowStoreDay : 0,
                        Fare: _this.ShowRwardFare != "" ? _this.ShowRwardFare : 0,
                        OneDrawMoney: _this.ShowRwardOneDrawMoney != "" ? _this.ShowRwardOneDrawMoney : 0,
                        IsOpen:_this.ShowRwardIsOpen,
                        CreateTime: moment(Date.now()).format('YYYY-MM-DD'),
                        Introduction: _this.ShowRwardIntroduction,
                        Image: _this.ShowRwardImage,
                        HasSelectNumber: _this.ShowHasSelectNumber,
                    };

                    axios.defaults.headers.common['RequestVerificationToken'] = $('input[name="__RequestVerificationToken"]').val();
                    axios.post(`@Url.Action("Create","ShowRawards")`, request)
                        .then((res) => {
                            $('#showDetail').modal('hide');
                            _this.getRawardLibs();
                            _this.clrarModal();
                        })
                        .catch((err) => {
                            //console.log(err.response.data);
                            _this.ErrorTitle = Object.keys(err.response.data);
                            let ArratList = [];
                            for (let item in err.response.data) {
                                ArratList.push(err.response.data[item]);
                            }
                            _this.ErrorMessage = ArratList;

                        });
                },
                selectPerPage(e) {
                    let _this = this;
                    let selectPerPage = parseInt(e.target.value);
                    //console.log(selectPerPage);
                    _this.setCookie('datatablePageLength', selectPerPage, 365);
                    _this.savedPageLength = selectPerPage;
                    _this.searchInput = "";
                    _this.filterDataPage();
                },
                filterDataPage() {
                    let _this = this;
                    _this.nowPage = 1;
                    _this.paginationNum = Math.ceil(_this.filterdbData.length / _this.savedPageLength);
                },
                createPicture(imageName) {
                    return `${this.imageAddress}${imageName}`;
                },
                selectSeries() {
                    let _this = this;
                    _this.selectNamesList = [];
                    _this.selectImageList = [];
                    _this.ShowRwardImage = '';
                    $("#previewImage").attr("src", '');
                    for (let item of _this.imageData) {
                        if (item.series == _this.nowSelectSeries) {
                            if (_this.selectNamesList.indexOf(item.name) == -1) {
                                _this.selectNamesList.push(item.name);
                            }
                        }
                    }
                },
                selectNames() {
                    let _this = this;
                    _this.selectImageList = [];
                    for (let item of _this.imageData) {
                        if (item.name == _this.nowSelectName) {
                            if (_this.selectImageList.indexOf(item.imageName) == -1) {
                                _this.selectImageList.push(item.imageName);
                            }
                        }
                    }
                },
                selectImage() {
                    let _this = this;
                    $("#previewImage").attr("src", `${_this.imageAddress}${_this.ShowRwardImage}`);
                },
                selectFactory() {
                    let _this = this;
                    _this.selectFactoryList.forEach(function(item){
                        if (item.name == _this.ShowRawardFirm) {
                            _this.ShowRawardFirmId = item.factoryId
                        }
                    })                   
                },
                changeFactoryName(index){
                    let factoryName = '';
                    this.selectFactoryList.forEach(function(item){
                        if(item.factoryId == index){
                            factoryName = item.name
                        }
                    })
                    return factoryName;
                }
            },
            mounted() {              
                let _this = this;

                //每頁幾筆的內容
                let getCookiePage = _this.getCookie('datatablePageLength');

                if (getCookiePage == null) {
                    _this.savedPageLength = _this.defaultPageLength;
                    _this.setCookie('datatablePageLength', _this.savedPageLength, 365);
                } else {
                    _this.savedPageLength = parseInt(getCookiePage);
                }
                _this.getRawardLibs();
            },
            computed: {
                filterdbData() {
                    let _this = this;
                    let filterData = [];

                    switch (this.nowFilter) {
                        case "全部":
                            for (let item of _this.dbData) {
                                if (item.series.includes(_this.searchInput) || item.name.includes(_this.searchInput)) {
                                    filterData.push(item)
                                }
                            }
                            break;
                        case "系列":
                            for (let item of _this.dbData) {
                                if (item.series.includes(_this.searchInput)) {
                                    filterData.push(item)
                                }
                            }
                            break;
                        case "名稱":
                            for (let item of _this.dbData) {
                                if (item.name.includes(_this.searchInput)) {
                                    filterData.push(item)
                                }
                            }
                            break;
                        case "廠商":
                            for (let item of _this.dbData) {
                                if (item.firm.includes(_this.searchInput)) {
                                    filterData.push(item)
                                }
                            }
                            break;
                    }
                    return filterData
                },
                filterPageData() {
                    let firstNum = (this.nowPage - 1) * this.savedPageLength;
                    let lastNum;
                    let filterData = this.filterdbData;
                    let filterPageData = [];

                    if ((this.nowPage * this.savedPageLength) < this.filterdbData.length) {
                        lastNum = this.nowPage * this.savedPageLength;
                    } else {
                        lastNum = this.filterdbData.length;
                    }

                    for (let i = firstNum; i < lastNum; i++) {
                        filterPageData.push(filterData[i]);
                    }

                    return filterPageData;
                },
                seriesErrorMessage() {
                    let hasTitle = this.ErrorTitle.some(e => e.includes("Series"));
                    if (hasTitle) {
                        let index = this.ErrorTitle.indexOf("Series");
                        let msg = this.ErrorMessage[index].join(", ")
                        return msg
                    } else {
                        return
                    }
                },
                nameErrorMessage() {
                    let hasTitle = this.ErrorTitle.some(e => e.includes("Name"));
                    if (hasTitle) {
                        let index = this.ErrorTitle.indexOf("Name");
                        let msg = this.ErrorMessage[index].join(", ")
                        return msg
                    } else {
                        return
                    }
                },
                firmErrorMessage() {
                    let hasTitle = this.ErrorTitle.some(e => e.includes("FactoryId"));
                    if (hasTitle) {
                        let index = this.ErrorTitle.indexOf("FactoryId");
                        let msg = this.ErrorMessage[index].join(", ")
                        return msg
                    } else {
                        return
                    }
                },
                addProErrorMessage() {
                    let hasTitle = this.ErrorTitle.some(e => e.includes("AddProbability"));
                    if (hasTitle) {
                        let index = this.ErrorTitle.indexOf("AddProbability");
                        let msg = this.ErrorMessage[index].join(", ")
                        return msg
                    } else {
                        return
                    }
                },
                nowProErrorMessage() {
                    let hasTitle = this.ErrorTitle.some(e => e.includes("NowProbability"));
                    if (hasTitle) {
                        let index = this.ErrorTitle.indexOf("NowProbability");
                        let msg = this.ErrorMessage[index].join(", ")
                        return msg
                    } else {
                        return
                    }
                },
                allowErrorMessage() {
                    let hasTitle = this.ErrorTitle.some(e => e.includes("AllowStoreDay"));
                    if (hasTitle) {
                        let index = this.ErrorTitle.indexOf("AllowStoreDay");
                        let msg = this.ErrorMessage[index].join(", ")
                        return msg
                    } else {
                        return
                    }
                },
                fareErrorMessage() {
                    let hasTitle = this.ErrorTitle.some(e => e.includes("Fare"));
                    if (hasTitle) {
                        let index = this.ErrorTitle.indexOf("Fare");
                        let msg = this.ErrorMessage[index].join(", ")
                        return msg
                    } else {
                        return
                    }
                },
                moneyErrorMessage() {
                    let hasTitle = this.ErrorTitle.some(e => e.includes("OneDrawMoney"));
                    if (hasTitle) {
                        let index = this.ErrorTitle.indexOf("OneDrawMoney");
                        let msg = this.ErrorMessage[index].join(", ")
                        return msg
                    } else {
                        return
                    }
                },
                timeErrorMessage() {
                    let hasTitle = this.ErrorTitle.some(e => e.includes("CreateTime"));
                    if (hasTitle) {
                        let index = this.ErrorTitle.indexOf("CreateTime");
                        let msg = this.ErrorMessage[index].join(", ")
                        return msg
                    } else {
                        return
                    }
                },
                imageErrorMessage() {
                    let hasTitle = this.ErrorTitle.some(e => e.includes("Image"));
                    if (hasTitle) {
                        let index = this.ErrorTitle.indexOf("Image");
                        let msg = this.ErrorMessage[index].join(", ")
                        return msg
                    } else {
                        return
                    }
                },
                timeFilter(){
                    return this.ShowRwardCreateTime != null ? moment(this.ShowRwardCreateTime).format('YYYY-MM-DD') : moment(Date.now()).format('YYYY-MM-DD');
                },
            },
        };

        let app = Vue.createApp(vueApp).mount("#app");
    </script>
}
